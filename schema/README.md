**Внимание:** Текст ниже в основном не соотвествует, тому как была решена задача в *SchemaToGraphQL.js*.

# Загрузка схемы хранимых процедур

Общий код для загрузки схемы (методанных) процедур.  При этом к схеме могут прилагаться дополнительные файлы, 
позволяющие модифицировать интерфейс процедур, для использование в graphQl

## Структура папки со схемами процедур

папка содержит следующие файлы:
*<имя хранимой процедуры>.js* - схема хранимой процедуры
*<имя хранимой процедуры>.schema.js* - модификация схемы graphql для хранимой процедуры
*<имя хранимой процедуры>.resolver.js* - модификация resolver'а для хранимой процедуры

Файл с другим расширением, чем js, игонорируются.

Если есть файл .schema.js или файл .resolver.js, но при этом нет соответствующего файла 
*<имя хранимой процедуры>.js*, то выдается ошибка.

Наличие файла .schema.js, не обязательно означает что нужен файл .resolver.js.  Например:

1. если .schema.js исключает часть полей из выдачи, то для этого не нужна дополнительная логика в .resolver.js

2. если .resolver.js изменяет данные в конкретной колонке, то схема остается исходной, и не нужен .schema.js

## Схема хранимой процедуры

Для каждой хранимой процедуры в папке schema есть отдельный файл <имя процедур>.js, который содержит:
- имя процедуры
- пример её вызова 
- текстовое описание
- список параметров процедуры
- список полей, в таблице получаемой в результате

Пример:

```
export default {
  name: 'p_ro_location_select',  
  procCall: `p_ro_location_select @email='tef2@online.siberia.net', @searchTxt='Москва'`,  
  description: 'Список локаций',
  params: [
    {
      name: 'email',
      type: 'string',
      length: 320,
      required: true,
      description: 'e-mail пользователя',
    },
    ...
  ],
  fldsOut: [
    {
      name: 'loc_uid',
      type: 'int',
      notNull: true
    },
    ...
  ]
}
```


## Модификатор graphQl схемы

Модификатор схемы, должен иметь возможность:

1. скрыть параметры процедуры, которые не должны быть доступны через graphql

2. добавить параметры, которые не будут передаваться в хранимую процедуру, но могут повлиять на выдачу результата

3. скрыть часть полей из результата хранимой процедуры, чтобы они не выдавались через интерфейс graphql

4. добавить поля в результат, которые могут содержать как обработанные данные от хранимой процедуры, так и данные 
   полученные от других запросов, так и других источников
    
*Пример 1*:

Добавить в выдачу поле id, содержащее значение в формате globalId, на основе значения одного из полей возвращенных 
хранимой процедурой

*Пример 2*:

При выдаче поля содержащего список в формате XML, выдать его как graphQl список элементов типа содержащего строки данных
из XML выдачи.

Структура файла:

```

```

## Модификтор параметров и данных хранимой процедуры

Выполняет действия по работе с параметрами и по изменению результата работы хранимой процедуры, для выдачи в graphQl.
Могут быть следущие действия:

- все что перечислено в разделе *Модификатор graphQl схемы* (см. выше)

- модификацию произвольных колонок результата без изменения их типа (Например: base64 encoding строчного значения)

## Дополнительная информация для работы с процедурами

1. Есть доступ к хранимой процедуре через интерфейс graphql (По умолчанию - нет)

2. Есть ли у процедуры стандартные параметры для авторизации.   Если есть, то эти параметры автоматически помечаются как
   не доступные через graphQl (По умолчанию - есть)
   
   *TODO*: Авторизации могут отличаться для разных реализаций API - так что логично работу с параметрами авторизации
    вынести в middleware (plugin) код.

## Стандартные модификации для параметров и результатов хранимых процедур

Для оптимизации труда, наиболее общие модификации можно выполнить без создания файлов .schema.js и .resolver.js.  
Вместо этого можно использовать graphQl аттрибуты в схеме.

Основные задачи:

1. Добавление globalId в возвращаемые записи, на основе значения одного из полей результата

    *Прим.*: При этом исходное поле для значения поля id, из выдачи не удаляется. 
   
2. Скрытие поля из выдачи

3. Скрытие поля из параметров
